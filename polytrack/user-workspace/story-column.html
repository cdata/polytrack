<link rel="import" href="../polytrack-element-behavior.html">
<link rel="import" href="../droppable-behavior.html">
<link rel="import" href="story-card.html">
<dom-module id="story-column">
  <style>
    :host {
      display: block;
      position: relative;
      padding: 0 1em;
      overflow: auto;
    }

    h1 {
      font-size: 16px;
      font-weight: normal;
      font-style: italic;
      text-align: center;
      color: var(--paper-grey-600);
    }

    story-card {
      max-height: 300px;
    }

    story-card:before {
      content: '';
      display: none;
      position: absolute;

      top: -0.66em;

      box-sizing: border-box;
      width: 100%;
      height: 0.33em;
      z-index: 1;
      background-color: var(--paper-light-blue-100);
      border: 1px solid var(--paper-light-blue-a200);
    }

    story-card.preview-drop:before {
      display: block;
    }
  </style>
  <template>
    <firebase-document
      location="[[_columnLocation(firebaseRoutes, columnId)]]"
      data="{{column}}">
    </firebase-document>
    <h1>[[column.name]]</h1>
    <template is="dom-repeat" items="[[column.cards]]" as="cardId">
      <story-card
        card-id="[[cardId]]"
        disable-text-selection
        firebase-routes="[[firebaseRoutes]]"
        user-auth="[[userAuth]]">
      </story-card>
    </template>
  </template>
</dom-module>
<script>
Polymer({
  is: 'story-column',

  behaviors: [
    Polymer.PolytrackElementBehavior,
    Polymer.DroppableBehavior
  ],

  properties: {
    columnId: {
      type: String,
      notify: true
    },

    column: {
      type: Object,
      notify: true
    }
  },

  get firstCard() {
    return Polymer.dom(this.root).querySelector('story-card');
  },

  addCard: function(cardId, beforeCardId) {
    if (beforeCardId) {
      this.splice(
        'column.cards',
        this.column.cards.indexOf(beforeCardId),
        0,
        cardId
      );
    } else {
      if (this.column.cards) {
        this.push('column.cards', cardId);
      } else {
        this.set('column.cards', [cardId]);
      }
    }
  },

  removeCard: function(cardId) {
    this.splice(
      'column.cards',
      this.column.cards.indexOf(cardId),
      1
    );
  },

  _columnLocation: function(firebaseRoutes, columnId) {
    return firebaseRoutes.columnLocation(columnId);
  },

  _cardsLocation: function(firebaseRoutes, columnId) {
    return firebaseRoutes.columnCardsLocation(columnId);
  }
});
</script>
